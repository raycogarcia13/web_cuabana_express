"use strict";(self.webpackChunkcubana_web=self.webpackChunkcubana_web||[]).push([[189],{189:(e,a,s)=>{s.r(a),s.d(a,{default:()=>h});var n=s(43);const r=async e=>{try{return await e()}catch(a){throw(e=>{if(null!==e&&void 0!==e&&e.redirect){localStorage.removeItem("cubana_auth");const a=e.expired?"Tu sesi\xf3n ha expirado. Por favor inicia sesi\xf3n nuevamente.":e.message||"Tu sesi\xf3n ha finalizado. Por favor inicia sesi\xf3n nuevamente.";return alert(a),void(window.location.href=e.redirect)}if(null!==e&&void 0!==e&&e.message)throw console.error("API Error:",e.message),e})(a),a}},i="https://api-cubana-express.vercel.app/api",t=()=>({Authorization:`Bearer ${JSON.parse(localStorage.getItem("cubana_auth")||"{}").token}`,"Content-Type":"application/json"}),o={getAllRecargas:async()=>r(async()=>{const e=await fetch(`${i}/recargas`,{headers:t()});if(!e.ok){throw await e.json()}return await e.json()}),getRecargaById:async e=>r(async()=>{const a=await fetch(`${i}/recargas/${e}`,{headers:t()});if(!a.ok){throw await a.json()}return await a.json()}),createRecarga:async e=>r(async()=>{const a=await fetch(`${i}/recargas`,{method:"POST",headers:t(),body:JSON.stringify(e)});if(!a.ok){throw await a.json()}return await a.json()}),updateRecarga:async(e,a)=>r(async()=>{const s=await fetch(`${i}/recargas/${e}`,{method:"PUT",headers:t(),body:JSON.stringify(a)});if(!s.ok){throw await s.json()}return await s.json()}),deleteRecarga:async e=>r(async()=>{const a=await fetch(`${i}/recargas/${e}`,{method:"DELETE",headers:t()});if(!a.ok){throw await a.json()}}),confirmarRecarga:async(e,a)=>r(async()=>{const s=await fetch(`${i}/recargas/${e}/confirmar`,{method:"PATCH",headers:t(),body:JSON.stringify({confirmation:a})});if(!s.ok){throw await s.json()}return await s.json()}),getRecargasByCliente:async e=>r(async()=>{const a=await fetch(`${i}/recargas/cliente/${e}`,{headers:t()});if(!a.ok){throw await a.json()}return await a.json()}),getOfertasActivas:async()=>r(async()=>{const e=await fetch(`${i}/ofertas-recargas`,{headers:t()});if(!e.ok){throw await e.json()}return(await e.json()).filter(e=>e.activa)})};var c=s(197),l=s(0),d=(s(664),s(579));const h=()=>{var e,a,s,r,i,t,h,m;const[u,j]=(0,n.useState)([]),[x,v]=(0,n.useState)([]),[g,f]=(0,n.useState)([]),[p,b]=(0,n.useState)([]),[N,y]=(0,n.useState)(""),[w,C]=(0,n.useState)(""),[S,P]=(0,n.useState)(""),[k,A]=(0,n.useState)(!1),[_,R]=(0,n.useState)(!1),[E,$]=(0,n.useState)(!1),[T,F]=(0,n.useState)(null),[D,O]=(0,n.useState)(""),[q,B]=(0,n.useState)(!0),[I,z]=(0,n.useState)(""),[J,L]=(0,n.useState)({oferta:"",client:"",phone:"",confirmation:"",destinationProvince:""});(0,n.useEffect)(()=>{M()},[]);const M=async()=>{try{B(!0),z("");const[e,a,s,n]=await Promise.all([o.getAllRecargas(),c.A.getAllClients(),l.A.getAllProvinces(),o.getOfertasActivas()]);j(e),v(a),f(s),b(n)}catch(I){console.error("Error cargando datos:",I),z("Error cargando datos. Verifica tu conexi\xf3n.")}finally{B(!1)}},U=async e=>{try{const a=await c.A.createClient(e);v([...x,a]),y(a._id),L({...J,client:a._id}),R(!1)}catch(I){console.error("Error creating client:",I),z(I.message||"Error al crear el cliente")}};return q?(0,d.jsx)("div",{className:"remesa-management-container",children:(0,d.jsxs)("div",{className:"loading-container",children:[(0,d.jsx)("div",{className:"loading-spinner"}),(0,d.jsx)("p",{children:"Cargando datos..."})]})}):(0,d.jsxs)("div",{className:"remesa-management-container",children:[(0,d.jsxs)("div",{className:"remesa-management-header",children:[(0,d.jsx)("h2",{children:"Gesti\xf3n de Recargas"}),(0,d.jsxs)("button",{className:"add-remesa-btn",onClick:()=>A(!0),children:[(0,d.jsx)("span",{className:"btn-icon",children:"+"})," Nueva Recarga"]})]}),I&&(0,d.jsxs)("div",{className:"error-message",children:[(0,d.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),I]}),(0,d.jsx)("div",{className:"remesas-table-container",children:(0,d.jsxs)("table",{className:"remesas-table",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{children:"Cliente"}),(0,d.jsx)("th",{children:"Oferta"}),(0,d.jsx)("th",{children:"Tel\xe9fono"}),(0,d.jsx)("th",{children:"Monto"}),(0,d.jsx)("th",{children:"Provincia"}),(0,d.jsx)("th",{children:"Estado"}),(0,d.jsx)("th",{children:"Fecha"}),(0,d.jsx)("th",{children:"Acciones"})]})}),(0,d.jsx)("tbody",{children:u.map(e=>{var a,s,n,r,i;return(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:(null===(a=e.client)||void 0===a?void 0:a.name)||"N/A"}),(0,d.jsx)("td",{children:(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:(null===(s=e.oferta)||void 0===s?void 0:s.titulo)||"N/A"}),(null===(n=e.oferta)||void 0===n?void 0:n.bonos)&&e.oferta.bonos.length>0&&(0,d.jsx)("div",{className:"bonos-list",children:e.oferta.bonos.map((e,a)=>(0,d.jsx)("span",{className:"bono-tag",children:e.titulo},a))})]})}),(0,d.jsx)("td",{children:e.phone}),(0,d.jsxs)("td",{className:"amount",children:["$",e.amount.toFixed(2)]}),(0,d.jsx)("td",{children:(null===(r=e.destinationProvince)||void 0===r?void 0:r.name)||"N/A"}),(0,d.jsx)("td",{children:(0,d.jsx)("span",{className:"status-badge "+(i=e.status,"Realizado"===i?"completed":"pending"),children:e.status})}),(0,d.jsx)("td",{children:new Date(e.date).toLocaleDateString("es-CU")}),(0,d.jsx)("td",{children:(0,d.jsx)("div",{className:"actions",children:"Pendiente"===e.status&&(0,d.jsx)("button",{className:"action-btn confirm-btn",onClick:()=>(e=>{F(e),O(""),$(!0)})(e),title:"Confirmar recarga",children:"\u2705 Confirmar"})})})]},e._id)})})]})}),k&&(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal-content",children:[(0,d.jsxs)("div",{className:"modal-header",children:[(0,d.jsx)("h3",{children:"Nueva Recarga"}),(0,d.jsx)("button",{className:"modal-close",onClick:()=>A(!1),children:"\xd7"})]}),(0,d.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{z("");const e={...J,confirmation:"Pendiente de confirmaci\xf3n"},s=await o.createRecarga(e);try{const e=await o.getAllRecargas();j(e)}catch(a){console.error("Error refreshing recargas list:",a),j([s,...u])}L({oferta:"",client:"",phone:"",confirmation:"",destinationProvince:""}),y(""),C(""),P(""),A(!1),O("")}catch(I){console.error("Error creating recarga:",I),z(I.message||"Error al crear la recarga")}},className:"remesa-form",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"oferta",children:"Oferta *"}),(0,d.jsxs)("select",{id:"oferta",value:w,onChange:e=>{return a=e.target.value,C(a),p.find(e=>e._id===a),void L({...J,oferta:a});var a},required:!0,children:[(0,d.jsx)("option",{value:"",children:"Seleccionar oferta"}),p.map(e=>(0,d.jsxs)("option",{value:e._id,children:[e.titulo," - $",e.precio.toFixed(2)]},e._id))]}),w&&(0,d.jsxs)("div",{className:"oferta-details",children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Descripci\xf3n:"})," ",null===(e=p.find(e=>e._id===w))||void 0===e?void 0:e.descripcion]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Precio:"})," $",null===(a=p.find(e=>e._id===w))||void 0===a?void 0:a.precio.toFixed(2)]}),(null===(s=p.find(e=>e._id===w))||void 0===s?void 0:s.bonos)&&(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Bonos incluidos:"}),(0,d.jsx)("div",{className:"bonos-list",children:null===(r=p.find(e=>e._id===w))||void 0===r?void 0:r.bonos.map((e,a)=>(0,d.jsxs)("span",{className:"bono-tag",children:[e.titulo," (",e.tipo,")"]},a))})]})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"client",children:"Cliente *"}),(0,d.jsxs)("select",{id:"client",value:N,onChange:e=>{y(e.target.value),L({...J,client:e.target.value})},required:!0,children:[(0,d.jsx)("option",{value:"",children:"Seleccionar cliente"}),x.map(e=>(0,d.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"phone",children:"Tel\xe9fono *"}),(0,d.jsx)("input",{type:"tel",id:"phone",value:J.phone,onChange:e=>L({...J,phone:e.target.value}),placeholder:"Tel\xe9fono del cliente",required:!0})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"destinationProvince",children:"Provincia Destino *"}),(0,d.jsxs)("select",{id:"destinationProvince",value:S,onChange:e=>{P(e.target.value),L({...J,destinationProvince:e.target.value})},required:!0,children:[(0,d.jsx)("option",{value:"",children:"Seleccionar provincia"}),g.map(e=>(0,d.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,d.jsxs)("div",{className:"modal-actions",children:[(0,d.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>A(!1),children:"Cancelar"}),(0,d.jsx)("button",{type:"submit",className:"btn-primary",children:"Crear Recarga"})]})]})]})}),_&&(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal-content",children:[(0,d.jsxs)("div",{className:"modal-header",children:[(0,d.jsx)("h3",{children:"Crear Nuevo Cliente"}),(0,d.jsx)("button",{className:"modal-close",onClick:()=>R(!1),children:"\xd7"})]}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault();const a=new FormData(e.currentTarget);U({name:a.get("name"),email:a.get("email"),phone:a.get("phone"),address:a.get("address")})},className:"client-form",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"clientName",children:"Nombre *"}),(0,d.jsx)("input",{type:"text",id:"clientName",name:"name",required:!0})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"clientEmail",children:"Email *"}),(0,d.jsx)("input",{type:"email",id:"clientEmail",name:"email",required:!0})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"clientPhone",children:"Tel\xe9fono *"}),(0,d.jsx)("input",{type:"tel",id:"clientPhone",name:"phone",required:!0})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"clientAddress",children:"Direcci\xf3n"}),(0,d.jsx)("input",{type:"text",id:"clientAddress",name:"address"})]}),(0,d.jsxs)("div",{className:"form-actions",children:[(0,d.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>R(!1),children:"Cancelar"}),(0,d.jsx)("button",{type:"submit",className:"btn-primary",children:"Crear Cliente"})]})]})]})}),E&&T&&(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal-content",style:{padding:"10px"},children:[(0,d.jsxs)("div",{className:"modal-header",children:[(0,d.jsx)("h3",{children:"Confirmar Recarga"}),(0,d.jsx)("button",{className:"modal-close",onClick:()=>$(!1),children:"\xd7"})]}),(0,d.jsxs)("div",{className:"remesa-details",children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Cliente:"})," ",(null===(i=T.client)||void 0===i?void 0:i.name)||"N/A"]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Oferta:"})," ",(null===(t=T.oferta)||void 0===t?void 0:t.titulo)||"N/A"]}),(null===(h=T.oferta)||void 0===h?void 0:h.bonos)&&T.oferta.bonos.length>0&&(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Bonos incluidos:"}),(0,d.jsx)("div",{className:"bonos-list",children:T.oferta.bonos.map((e,a)=>(0,d.jsxs)("span",{className:"bono-tag",children:[e.titulo," (",e.tipo,")"]},a))}),(0,d.jsx)("ul",{className:"bonos-list-detail",children:T.oferta.bonos.map((e,a)=>(0,d.jsxs)("li",{children:[(0,d.jsx)("strong",{children:e.titulo})," - Tipo: ",e.tipo]},a))})]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Tel\xe9fono:"})," ",T.phone]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Monto:"})," $",T.amount.toFixed(2)]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Provincia Destino:"})," ",(null===(m=T.destinationProvince)||void 0===m?void 0:m.name)||"N/A"]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"confirmationText",children:"Confirmaci\xf3n *"}),(0,d.jsx)("textarea",{id:"confirmationText",value:D,onChange:e=>O(e.target.value),placeholder:"Ingrese el texto de confirmaci\xf3n",required:!0,rows:6})]})]}),(0,d.jsxs)("div",{className:"modal-actions",children:[(0,d.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>$(!1),children:"Cancelar"}),(0,d.jsx)("button",{type:"button",className:"btn-primary",onClick:async()=>{if(T&&D.trim())try{z(""),await o.confirmarRecarga(T._id,D);const e=u.map(e=>e._id===T._id?{...e,status:"Realizado",confirmation:D}:e);j(e),$(!1),F(null),O("")}catch(I){console.error("Error confirming recarga:",I),z(I.message||"Error al confirmar la recarga")}else z("Por favor ingrese el texto de confirmaci\xf3n")},disabled:!D.trim(),children:"Confirmar Recarga"})]})]})})]})}},664:()=>{}}]);
//# sourceMappingURL=189.dfe72b99.chunk.js.map