"use strict";(self.webpackChunkcubana_web=self.webpackChunkcubana_web||[]).push([[125],{125:(e,a,s)=>{s.r(a),s.d(a,{default:()=>o});var t=s(43),r=s(579);const o=()=>{const[e,a]=(0,t.useState)([]),[s,o]=(0,t.useState)(!0),[i,n]=(0,t.useState)(!1),[c,l]=(0,t.useState)(!1),[d,h]=(0,t.useState)(null),[u,m]=(0,t.useState)(null),[p,x]=(0,t.useState)(""),[j,b]=(0,t.useState)(""),[v,f]=(0,t.useState)({titulo:"",descripcion:"",precio:0,costo:0,bonos:[],activa:!0});(0,t.useEffect)(()=>{g()},[]);const g=async()=>{try{const e=JSON.parse(localStorage.getItem("cubana_auth")||"{}").token,s=await fetch("https://api-cubana-express.vercel.app/api/ofertas-recargas",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),t=await s.json();a(t)}catch(p){console.error("Error cargando ofertas:",p),x("Error cargando ofertas")}finally{o(!1)}},N=e=>{const{name:a,value:s}=e.target;f(e=>({...e,[a]:"precio"===a||"costo"===a?parseFloat(s)||0:s}))},y=(e,a,s)=>{const t=[...v.bonos];t[e]={...t[e],[a]:s},f(e=>({...e,bonos:t}))},C=()=>{f({titulo:"",descripcion:"",precio:0,costo:0,bonos:[],activa:!0})},E=()=>{n(!1),l(!1),h(null),m(null),C(),x(""),b("")};return s?(0,r.jsx)("div",{className:"loading",children:"Cargando ofertas..."}):(0,r.jsxs)("div",{className:"oferta-recargas-management",children:[(0,r.jsxs)("div",{className:"header",children:[(0,r.jsx)("h2",{children:"Gesti\xf3n de Ofertas de Recargas"}),(0,r.jsx)("button",{className:"btn-primary",onClick:()=>n(!0),children:"+ Nueva Oferta"})]}),p&&(0,r.jsx)("div",{className:"error-message",children:p}),j&&(0,r.jsx)("div",{className:"success-message",children:j}),(0,r.jsx)("div",{className:"ofertas-list",children:(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"T\xedtulo"}),(0,r.jsx)("th",{children:"Precio"}),(0,r.jsx)("th",{children:"Costo"}),(0,r.jsx)("th",{children:"Bonos"}),(0,r.jsx)("th",{children:"Estado"}),(0,r.jsx)("th",{children:"Acciones"})]})}),(0,r.jsx)("tbody",{children:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.titulo}),(0,r.jsxs)("td",{children:["$",e.precio.toFixed(2)]}),(0,r.jsxs)("td",{children:["$",e.costo.toFixed(2)]}),(0,r.jsx)("td",{children:(0,r.jsx)("div",{className:"bonos-list",children:e.bonos.map((e,a)=>(0,r.jsxs)("span",{className:"bono-tag",children:[e.titulo," (",e.tipo,")"]},a))})}),(0,r.jsx)("td",{children:(0,r.jsx)("span",{className:"status-badge "+(e.activa?"active":"inactive"),children:e.activa?"Activa":"Inactiva"})}),(0,r.jsxs)("td",{children:[(0,r.jsx)("button",{className:"btn-edit",onClick:()=>(e=>{h(e),f({titulo:e.titulo,descripcion:e.descripcion,precio:e.precio,costo:e.costo,bonos:e.bonos,activa:e.activa}),l(!0)})(e),title:"Editar oferta",children:"\u270f\ufe0f"}),(0,r.jsx)("button",{className:"btn-toggle",onClick:()=>(async e=>{try{const a=JSON.parse(localStorage.getItem("cubana_auth")||"{}").token;(await fetch(`https://api-cubana-express.vercel.app/api/ofertas-recargas/${e}/toggle`,{method:"PATCH",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}})).ok?g():x("Error al cambiar estado de la oferta")}catch(p){console.error("Error cambiando estado:",p),x("Error al cambiar estado de la oferta")}})(e._id),title:e.activa?"Desactivar":"Activar",children:e.activa?"\ud83d\udd34":"\ud83d\udfe2"}),(0,r.jsx)("button",{className:"btn-delete",onClick:()=>{return a=e._id,void m(a);var a},title:"Eliminar oferta",children:"\ud83d\uddd1\ufe0f"})]})]},e._id))})]})}),(i||c)&&(0,r.jsx)("div",{className:"modal-overlay",style:{zIndex:9999},children:(0,r.jsxs)("div",{className:"modal-content",children:[(0,r.jsxs)("div",{className:"modal-header",children:[(0,r.jsx)("h3",{children:d?"Editar Oferta":"Nueva Oferta"}),(0,r.jsx)("button",{className:"modal-close",onClick:E,children:"\xd7"})]}),(0,r.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{x(""),b("");const e=JSON.parse(localStorage.getItem("cubana_auth")||"{}").token,a=d?`https://api-cubana-express.vercel.app/api/ofertas-recargas/${d._id}`:"https://api-cubana-express.vercel.app/api/ofertas-recargas",s=d?"PUT":"POST",t=await fetch(a,{method:s,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(v)});if(t.ok)b(d?"Oferta actualizada exitosamente":"Oferta creada exitosamente"),n(!1),l(!1),h(null),C(),g();else{const e=await t.json();x(e.message||"Error al guardar la oferta")}}catch(p){console.error("Error guardando oferta:",p),x("Error al guardar la oferta")}},className:"oferta-form",children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"titulo",children:"T\xedtulo *"}),(0,r.jsx)("input",{type:"text",id:"titulo",name:"titulo",value:v.titulo,onChange:N,required:!0,maxLength:200})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"descripcion",children:"Descripci\xf3n *"}),(0,r.jsx)("textarea",{id:"descripcion",name:"descripcion",value:v.descripcion,onChange:N,required:!0,maxLength:1e3,rows:4})]}),(0,r.jsxs)("div",{className:"form-row",children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"precio",children:"Precio *"}),(0,r.jsx)("input",{type:"number",id:"precio",name:"precio",value:v.precio,onChange:N,required:!0,min:"0",step:"0.01"})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"costo",children:"Costo *"}),(0,r.jsx)("input",{type:"number",id:"costo",name:"costo",value:v.costo,onChange:N,required:!0,min:"0",step:"0.01"}),(0,r.jsx)("span",{className:"description",children:"Se eliminar\xe1 automaticamente cuando se confirme del saldo de la provincia"})]})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{children:"Bonos"}),v.bonos.map((e,a)=>(0,r.jsx)("div",{className:"bono-item",children:(0,r.jsxs)("div",{className:"form-row",children:[(0,r.jsx)("div",{className:"form-group",children:(0,r.jsx)("input",{type:"text",placeholder:"T\xedtulo del bono",value:e.titulo,onChange:e=>y(a,"titulo",e.target.value),required:!0})}),(0,r.jsx)("div",{className:"form-group",children:(0,r.jsxs)("select",{value:e.tipo,onChange:e=>y(a,"tipo",e.target.value),required:!0,children:[(0,r.jsx)("option",{value:"Minutos",children:"Minutos"}),(0,r.jsx)("option",{value:"Mensajes",children:"Mensajes"}),(0,r.jsx)("option",{value:"Datos",children:"Datos"})]})}),(0,r.jsx)("div",{className:"form-group",children:(0,r.jsx)("button",{type:"button",className:"btn-remove",onClick:()=>(e=>{f(a=>({...a,bonos:a.bonos.filter((a,s)=>s!==e)}))})(a),children:"\ud83d\uddd1\ufe0f"})})]})},a)),(0,r.jsx)("button",{type:"button",className:"btn-add",onClick:()=>{f(e=>({...e,bonos:[...e.bonos,{titulo:"",tipo:"Minutos"}]}))},children:"+ Agregar Bono"})]}),(0,r.jsxs)("div",{className:"modal-actions",children:[(0,r.jsx)("button",{type:"button",className:"btn-secondary",onClick:E,children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",className:"btn-primary",children:d?"Actualizar":"Crear"})]})]})]})}),u&&(0,r.jsx)("div",{className:"modal-overlay",style:{zIndex:9999},children:(0,r.jsxs)("div",{className:"modal-content",children:[(0,r.jsxs)("div",{className:"modal-header",children:[(0,r.jsx)("h3",{children:"Confirmar Eliminaci\xf3n"}),(0,r.jsx)("button",{className:"modal-close",onClick:()=>m(null),children:"\xd7"})]}),(0,r.jsxs)("div",{className:"modal-body",children:[(0,r.jsx)("p",{children:"\xbfEst\xe1 seguro que desea eliminar esta oferta?"}),(0,r.jsx)("p",{children:"Esta acci\xf3n no se puede deshacer."})]}),(0,r.jsxs)("div",{className:"modal-actions",children:[(0,r.jsx)("button",{className:"btn-secondary",onClick:()=>m(null),children:"Cancelar"}),(0,r.jsx)("button",{className:"btn-delete",onClick:()=>(async e=>{try{const a=JSON.parse(localStorage.getItem("cubana_auth")||"{}").token;(await fetch(`https://api-cubana-express.vercel.app/api/ofertas-recargas/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}})).ok?(b("Oferta eliminada exitosamente"),m(null),g()):x("Error al eliminar la oferta")}catch(p){console.error("Error eliminando oferta:",p),x("Error al eliminar la oferta")}})(u),children:"Eliminar"})]})]})})]})}}}]);
//# sourceMappingURL=125.1ad082b8.chunk.js.map