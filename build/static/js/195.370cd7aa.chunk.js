"use strict";(self.webpackChunkcubana_web=self.webpackChunkcubana_web||[]).push([[195],{195:(e,a,s)=>{s.r(a),s.d(a,{default:()=>l});var r=s(43);const n=new class{constructor(){this.apiBaseUrl="https://api-cubana-express.vercel.app/api"}getAuthHeaders(){const e=localStorage.getItem("cubana_auth");if(!e)throw new Error("No hay token de autenticaci\xf3n");return{"Content-Type":"application/json",Authorization:`Bearer ${JSON.parse(e).token}`}}async getAllRemesas(){try{const e=await fetch(`${this.apiBaseUrl}/remesas`,{method:"GET",headers:this.getAuthHeaders()});if(!e.ok)throw new Error(`Error ${e.status}: ${e.statusText}`);return await e.json()}catch(e){throw console.error("Error obteniendo remesas:",e),e}}async getRemesaById(e){try{const a=await fetch(`${this.apiBaseUrl}/remesas/${e}`,{method:"GET",headers:this.getAuthHeaders()});if(!a.ok)throw new Error(`Error ${a.status}: ${a.statusText}`);return await a.json()}catch(a){throw console.error("Error obteniendo remesa:",a),a}}async createRemesa(e){try{const a=await fetch(`${this.apiBaseUrl}/remesas`,{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!a.ok){const e=await a.json();throw new Error(e.message||`Error ${a.status}`)}return await a.json()}catch(a){throw console.error("Error creando remesa:",a),a}}async updateRemesa(e,a){try{const s=await fetch(`${this.apiBaseUrl}/remesas/${e}`,{method:"PUT",headers:this.getAuthHeaders(),body:JSON.stringify(a)});if(!s.ok){const e=await s.json();throw new Error(e.message||`Error ${s.status}`)}return await s.json()}catch(s){throw console.error("Error actualizando remesa:",s),s}}async confirmarRemesa(e,a,s){try{const r={confirmation:a};s&&(r.beneficiary=s);const n=await fetch(`${this.apiBaseUrl}/remesas/${e}/confirmar`,{method:"PUT",headers:this.getAuthHeaders(),body:JSON.stringify(r)});if(!n.ok){const e=await n.json();throw new Error(e.message||`Error ${n.status}`)}return await n.json()}catch(r){throw console.error("Error confirmando remesa:",r),r}}async deleteRemesa(e){try{const a=await fetch(`${this.apiBaseUrl}/remesas/${e}`,{method:"DELETE",headers:this.getAuthHeaders()});if(!a.ok){const e=await a.json();throw new Error(e.message||`Error ${a.status}`)}}catch(a){throw console.error("Error eliminando remesa:",a),a}}};var i=s(197),t=s(0),o=(s(664),s(579));const l=()=>{var e,a,s,l,c;const[d,m]=(0,r.useState)([]),[h,u]=(0,r.useState)([]),[x,p]=(0,r.useState)([]),[j,v]=(0,r.useState)(""),[b,g]=(0,r.useState)(""),[y,f]=(0,r.useState)(!1),[N,w]=(0,r.useState)(!1),[C,E]=(0,r.useState)(!1),[S,B]=(0,r.useState)(null),[A,$]=(0,r.useState)(""),[k,F]=(0,r.useState)(!1),[R,T]=(0,r.useState)({name:"",phone:"",address:"",cardNumber:""}),[P,_]=(0,r.useState)(!0),[D,q]=(0,r.useState)(""),[I,U]=(0,r.useState)({amount:20,cost:20,client:"",beneficiary:"",destinationProvince:"",description:""});(0,r.useEffect)(()=>{H()},[]);const H=async()=>{try{_(!0),q("");const[e,a,s]=await Promise.all([n.getAllRemesas(),i.A.getAllClients(),t.A.getAllProvinces()]);m(e),u(a),p(s)}catch(D){console.error("Error cargando datos:",D),q("Error cargando datos. Verifica tu conexi\xf3n.")}finally{_(!1)}},z=(e,a)=>{T(s=>({...s,[e]:a}))},O=()=>{E(!1),B(null),$("")};return P?(0,o.jsx)("div",{className:"remesa-management-container",children:(0,o.jsxs)("div",{className:"loading-container",children:[(0,o.jsx)("div",{className:"loading-spinner"}),(0,o.jsx)("p",{children:"Cargando remesas..."})]})}):(0,o.jsxs)("div",{className:"remesa-management-container",children:[(0,o.jsxs)("div",{className:"remesa-management-header",children:[(0,o.jsx)("h2",{children:"Gesti\xf3n de Remesas"}),(0,o.jsxs)("button",{className:"add-remesa-btn",onClick:()=>f(!0),children:[(0,o.jsx)("span",{className:"btn-icon",children:"+"}),"Nueva Remesa"]})]}),D&&(0,o.jsxs)("div",{className:"error-message",children:[(0,o.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),D]}),(0,o.jsx)("div",{className:"remesas-table-container",children:(0,o.jsxs)("table",{className:"remesas-table",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Cliente"}),(0,o.jsx)("th",{children:"Beneficiario"}),(0,o.jsx)("th",{children:"Monto"}),(0,o.jsx)("th",{children:"Costo"}),(0,o.jsx)("th",{children:"Provincia Destino"}),(0,o.jsx)("th",{children:"Fecha"}),(0,o.jsx)("th",{children:"Estado"}),(0,o.jsx)("th",{children:"Acciones"})]})}),(0,o.jsx)("tbody",{children:d.map(e=>{var a,s,r,n,i;return(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(null===(a=e.client)||void 0===a?void 0:a.name)||"N/A"}),(0,o.jsx)("td",{children:(null===(s=e.beneficiary)||void 0===s?void 0:s.name)||"N/A"}),(0,o.jsxs)("td",{className:"amount",children:["$",e.amount.toFixed(2)]}),(0,o.jsxs)("td",{className:"cost",children:["$",e.cost.toFixed(2)]}),(0,o.jsx)("td",{children:(null===(r=e.destinationProvince)||void 0===r?void 0:r.name)||"N/A"}),(0,o.jsx)("td",{children:(i=e.date,new Date(i).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}))}),(0,o.jsx)("td",{children:(0,o.jsx)("span",{className:(n=e.status,"Realizado"===n?"status-badge completed":"status-badge pending"),children:e.status})}),(0,o.jsx)("td",{className:"actions",children:"Pendiente"===e.status&&(0,o.jsx)("button",{className:"action-btn confirm",onClick:()=>(e=>{var a;B(e),$(""),e.beneficiary&&"object"===typeof e.beneficiary?T({name:e.beneficiary.name||"",phone:e.beneficiary.phone||"",address:e.beneficiary.address||"",cardNumber:(null===(a=e.beneficiary)||void 0===a?void 0:a.cardNumber)||""}):T({name:"",phone:"",address:"",cardNumber:""}),E(!0)})(e),title:"Confirmar remesa",children:"\u2705"})})]},e._id)})})]})}),y&&(0,o.jsx)("div",{className:"modal-overlay",style:{zIndex:9999},children:(0,o.jsxs)("div",{className:"modal-content",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h3",{children:"Nueva Remesa"}),(0,o.jsx)("button",{className:"modal-close",onClick:()=>f(!1),children:"\xd7"})]}),(0,o.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{q("");let e={...I};"manual"===I.beneficiary&&k&&(e.beneficiary={name:R.name,phone:R.phone,address:R.address,cardNumber:R.cardNumber});const s=await n.createRemesa(e);try{const e=await n.getAllRemesas();m(e)}catch(a){console.error("Error refreshing remesas list:",a),m([s,...d])}f(!1),U({amount:20,cost:20,client:"",beneficiary:"",destinationProvince:"",description:""}),v(""),g(""),F(!1),T({name:"",phone:"",address:"",cardNumber:""})}catch(D){q(D.message||"Error creando remesa")}},className:"remesa-form",children:[(0,o.jsx)("div",{className:"form-row",children:(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"client",children:"Cliente *"}),(0,o.jsxs)("select",{id:"client",value:j,onChange:e=>(e=>{v(e);const a=h.find(a=>a._id===e);a&&a.recipients&&a.recipients.length,F(!0),g("manual"),U({...I,client:e,beneficiary:"manual"})})(e.target.value),required:!0,children:[(0,o.jsx)("option",{value:"",children:"Seleccione un cliente"}),h.map(e=>(0,o.jsx)("option",{value:e._id,children:e.name},e._id))]})]})}),j&&(0,o.jsx)("div",{className:"form-row",children:(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"beneficiary",children:"Beneficiario *"}),(0,o.jsxs)("select",{id:"beneficiary",value:b,onChange:e=>{var a;"manual"===(a=e.target.value)?(F(!0),g("manual"),U({...I,beneficiary:"manual"})):(F(!1),g(a),U({...I,beneficiary:a}))},required:!0,children:[(0,o.jsx)("option",{value:"manual",children:"+ Ingresar datos manualmente"}),(0,o.jsx)("option",{value:"",children:"Seleccione un beneficiario existente"}),(e=>{const a=h.find(a=>a._id===e);return(null===a||void 0===a?void 0:a.recipients)||[]})(j).map(e=>(0,o.jsx)("option",{value:e._id,children:e.name},e._id))]})]})}),k&&(0,o.jsxs)("div",{className:"beneficiary-editable",style:{marginLeft:"10px",marginTop:"5px",padding:"5px"},children:[(0,o.jsxs)("div",{className:"form-row",style:{marginBottom:"5px"},children:[(0,o.jsxs)("div",{className:"form-group",style:{marginBottom:"3px"},children:[(0,o.jsx)("label",{style:{marginBottom:"2px"},children:"Nombre del Beneficiario:"}),(0,o.jsx)("input",{type:"text",value:R.name,onChange:e=>z("name",e.target.value),placeholder:"Nombre del beneficiario",style:{padding:"6px"}})]}),(0,o.jsxs)("div",{className:"form-group",style:{marginBottom:"3px"},children:[(0,o.jsx)("label",{style:{marginBottom:"2px"},children:"Tel\xe9fono del Beneficiario:"}),(0,o.jsx)("input",{type:"tel",value:R.phone,onChange:e=>z("phone",e.target.value),placeholder:"Tel\xe9fono del beneficiario",style:{padding:"6px"}})]})]}),(0,o.jsxs)("div",{className:"form-row",style:{marginBottom:"5px"},children:[(0,o.jsxs)("div",{className:"form-group",style:{marginBottom:"3px"},children:[(0,o.jsx)("label",{style:{marginBottom:"2px"},children:"Direcci\xf3n del Beneficiario:"}),(0,o.jsx)("input",{type:"text",value:R.address,onChange:e=>z("address",e.target.value),placeholder:"Direcci\xf3n del beneficiario",style:{padding:"6px"}})]}),(0,o.jsxs)("div",{className:"form-group",style:{marginBottom:"3px"},children:[(0,o.jsx)("label",{style:{marginBottom:"2px"},children:"Tarjeta de Cr\xe9dito:"}),(0,o.jsx)("input",{type:"text",value:R.cardNumber,onChange:e=>z("cardNumber",e.target.value),placeholder:"N\xfamero de tarjeta de cr\xe9dito",style:{padding:"6px"}})]})]})]}),(0,o.jsxs)("div",{className:"form-row",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"amount",children:"Monto *"}),(0,o.jsx)("input",{type:"number",id:"amount",value:I.amount,onChange:e=>(e=>{const a=e<=100?20:20*Math.ceil(e/100);U({...I,amount:e,cost:a})})(parseFloat(e.target.value)||0),required:!0,min:"20",step:"1"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"cost",children:"Costo (20% del monto)"}),(0,o.jsx)("input",{type:"number",id:"cost",value:I.cost,onChange:e=>U({...I,cost:parseFloat(e.target.value)||0}),required:!0,min:"0",step:"1"})]})]}),(0,o.jsx)("div",{className:"form-row",children:(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"destinationProvince",children:"Provincia Destino *"}),(0,o.jsxs)("select",{id:"destinationProvince",value:I.destinationProvince,onChange:e=>U({...I,destinationProvince:e.target.value}),required:!0,children:[(0,o.jsx)("option",{value:"",children:"Seleccione una provincia"}),x.map(e=>(0,o.jsx)("option",{value:e._id,children:e.name},e._id))]})]})}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"description",children:"Descripci\xf3n"}),(0,o.jsx)("textarea",{id:"description",value:I.description,onChange:e=>U({...I,description:e.target.value}),rows:3,placeholder:"Ingrese una descripci\xf3n (opcional)"})]}),(0,o.jsxs)("div",{className:"modal-actions",children:[(0,o.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>f(!1),children:"Cancelar"}),(0,o.jsx)("button",{type:"submit",className:"btn-primary",children:"Crear Remesa"})]})]})]})}),N&&(0,o.jsx)("div",{className:"modal-overlay",style:{zIndex:9999},children:(0,o.jsxs)("div",{className:"modal-content",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h3",{children:"Nuevo Cliente"}),(0,o.jsx)("button",{className:"modal-close",onClick:()=>w(!1),children:"\xd7"})]}),(0,o.jsxs)("form",{onSubmit:e=>{e.preventDefault();const a=new FormData(e.currentTarget);(async e=>{try{q(""),console.log("Creating new client from RemesaManagement:",e);const a=await i.A.createClient(e);u([...h,a]),w(!1)}catch(D){q(D.message||"Error creando cliente")}})({name:a.get("name"),email:a.get("email"),phone:a.get("phone"),address:a.get("address"),cardNumber:a.get("cardNumber"),identityCard:a.get("identityCard")})},className:"client-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"name",children:"Nombre *"}),(0,o.jsx)("input",{type:"text",id:"name",name:"name",required:!0})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"email",children:"Email *"}),(0,o.jsx)("input",{type:"email",id:"email",name:"email",required:!0})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"phone",children:"Tel\xe9fono *"}),(0,o.jsx)("input",{type:"tel",id:"phone",name:"phone",required:!0})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"address",children:"Direcci\xf3n"}),(0,o.jsx)("input",{type:"text",id:"address",name:"address"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"cardNumber",children:"N\xfamero de Tarjeta"}),(0,o.jsx)("input",{type:"text",id:"cardNumber",name:"cardNumber",placeholder:"Opcional"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"identityCard",children:"Carnet de Identidad *"}),(0,o.jsx)("input",{type:"text",id:"identityCard",name:"identityCard",required:!0})]}),(0,o.jsxs)("div",{className:"modal-actions",children:[(0,o.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>w(!1),children:"Cancelar"}),(0,o.jsx)("button",{type:"submit",className:"btn-primary",children:"Crear Cliente"})]})]})]})}),C&&S&&(0,o.jsx)("div",{className:"modal-overlay",style:{zIndex:9999},children:(0,o.jsxs)("div",{className:"modal-content",style:{padding:10},children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h3",{children:"Confirmar Remesa"}),(0,o.jsx)("button",{className:"modal-close",onClick:O,children:"\xd7"})]}),(0,o.jsxs)("div",{className:"modal-body",children:[(0,o.jsxs)("div",{className:"remesa-details",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Cliente:"})," ",(null===(e=S.client)||void 0===e?void 0:e.name)||"N/A"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Beneficiario:"})," ",(null===(a=S.beneficiary)||void 0===a?void 0:a.name)||"N/A"]}),(null===(s=S.beneficiary)||void 0===s?void 0:s.phone)&&(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Tel\xe9fono:"})," ",S.beneficiary.phone]}),(null===(l=S.beneficiary)||void 0===l?void 0:l.cardNumber)&&(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"N\xfamero de Tarjeta:"})," ",S.beneficiary.cardNumber]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Monto:"})," $",S.amount.toFixed(2)]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Costo:"})," $",S.cost.toFixed(2)]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Provincia Destino:"})," ",(null===(c=S.destinationProvince)||void 0===c?void 0:c.name)||"N/A"]})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"confirmation",children:"Confirmaci\xf3n *"}),(0,o.jsx)("textarea",{id:"confirmation",value:A,onChange:e=>$(e.target.value),required:!0,rows:4,placeholder:"Ingrese los detalles de confirmaci\xf3n de la remesa..."})]}),D&&(0,o.jsxs)("div",{className:"error-message",children:[(0,o.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),D]})]}),(0,o.jsxs)("div",{className:"modal-actions",children:[(0,o.jsx)("button",{type:"button",style:{background:"#ba3539"},className:"btn-secondary",onClick:O,children:"Cancelar"}),(0,o.jsx)("button",{type:"button",className:"btn-primary",onClick:async()=>{if(S&&A.trim())try{await(async(e,a)=>{try{let s;q(""),null!==S&&void 0!==S&&S.beneficiary&&"object"===typeof S.beneficiary&&(s=R);const r=await n.confirmarRemesa(e,a,s);m(d.map(a=>a._id===e?r:a))}catch(D){q(D.message||"Error confirmando remesa")}})(S._id,A),O()}catch(D){q(D.message||"Error confirmando remesa")}else q("La confirmaci\xf3n es obligatoria")},disabled:!A.trim(),children:"Confirmar Remesa"})]})]})})]})}},664:()=>{}}]);
//# sourceMappingURL=195.370cd7aa.chunk.js.map