"use strict";(self.webpackChunkcubana_web=self.webpackChunkcubana_web||[]).push([[270],{270:(e,a,n)=>{n.r(a),n.d(a,{default:()=>c});var s=n(43),i=n(197),t=n(579);const r=e=>{let{client:a,onSave:n,onCancel:i}=e;const[r,l]=(0,s.useState)({_id:(null===a||void 0===a?void 0:a._id)||"",name:(null===a||void 0===a?void 0:a.name)||"",address:(null===a||void 0===a?void 0:a.address)||"",department:(null===a||void 0===a?void 0:a.department)||"",phone:(null===a||void 0===a?void 0:a.phone)||"",email:(null===a||void 0===a?void 0:a.email)||""});return(0,t.jsx)("div",{className:"modal-overlay",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h3",{children:a?"Editar Cliente":"Agregar Cliente"}),(0,t.jsx)("button",{className:"modal-close",onClick:i,children:"\xd7"})]}),(0,t.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),a)n(r);else{const{_id:e,...a}=r;n(a)}},className:"client-form",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"name",children:"Nombre *"}),(0,t.jsx)("input",{type:"text",id:"name",value:r.name,onChange:e=>l({...r,name:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"email",children:"Email *"}),(0,t.jsx)("input",{type:"email",id:"email",value:r.email,onChange:e=>l({...r,email:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"phone",children:"Tel\xe9fono *"}),(0,t.jsx)("input",{type:"tel",id:"phone",value:r.phone,onChange:e=>l({...r,phone:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"department",children:"Departamento *"}),(0,t.jsx)("input",{type:"text",id:"department",value:r.department,onChange:e=>l({...r,department:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"address",children:"Direcci\xf3n *"}),(0,t.jsx)("textarea",{id:"address",value:r.address,onChange:e=>l({...r,address:e.target.value}),required:!0,rows:3})]}),(0,t.jsxs)("div",{className:"modal-actions",children:[(0,t.jsx)("button",{type:"button",className:"btn-secondary",onClick:i,children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"btn-primary",children:a?"Actualizar":"Crear"})]})]})]})})},l=e=>{let{client:a,onAdd:n,onRemove:i,onCancel:r}=e;const[l,c]=(0,s.useState)(!1),[d,o]=(0,s.useState)({name:"",phone:"",address:"",bankCardNumber:""});return(0,t.jsx)("div",{className:"modal-overlay",children:(0,t.jsxs)("div",{className:"modal-content large",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsxs)("h3",{children:["Destinatarios de ",a.name]}),(0,t.jsx)("button",{className:"modal-close",onClick:r,children:"\xd7"})]}),(0,t.jsxs)("div",{className:"recipients-modal-content",children:[(0,t.jsxs)("div",{className:"recipients-header",children:[(0,t.jsxs)("h4",{children:["Destinatarios (",a.recipients.length,")"]}),(0,t.jsx)("button",{className:"btn-primary small",onClick:()=>c(!0),children:"+ Agregar Destinatario"})]}),(0,t.jsxs)("div",{className:"recipients-list",children:[a.recipients.map(e=>(0,t.jsxs)("div",{className:"recipient-item",children:[(0,t.jsxs)("div",{className:"recipient-info",children:[(0,t.jsx)("span",{className:"recipient-name",children:e.name}),(0,t.jsx)("span",{className:"recipient-phone",children:e.phone}),(0,t.jsx)("span",{className:"recipient-address",children:e.address}),e.bankCardNumber&&(0,t.jsxs)("span",{className:"recipient-card",children:["Tarjeta: ",e.bankCardNumber]})]}),(0,t.jsx)("button",{className:"btn-danger small",onClick:()=>i(e._id),title:"Eliminar destinatario",children:"Eliminar"})]},e._id)),0===a.recipients.length&&(0,t.jsx)("p",{className:"no-recipients",children:"No hay destinatarios registrados"})]}),l&&(0,t.jsxs)("div",{className:"add-recipient-form",children:[(0,t.jsx)("h5",{children:"Agregar Destinatario"}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),n(d),o({name:"",phone:"",address:"",bankCardNumber:""}),c(!1)},children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"recipientName",children:"Nombre *"}),(0,t.jsx)("input",{type:"text",id:"recipientName",value:d.name,onChange:e=>o({...d,name:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"recipientPhone",children:"Tel\xe9fono *"}),(0,t.jsx)("input",{type:"tel",id:"recipientPhone",value:d.phone,onChange:e=>o({...d,phone:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"recipientAddress",children:"Direcci\xf3n *"}),(0,t.jsx)("textarea",{id:"recipientAddress",value:d.address,onChange:e=>o({...d,address:e.target.value}),required:!0,rows:2})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"recipientCard",children:"N\xfamero de Tarjeta (opcional)"}),(0,t.jsx)("input",{type:"text",id:"recipientCard",value:d.bankCardNumber,onChange:e=>o({...d,bankCardNumber:e.target.value})})]}),(0,t.jsxs)("div",{className:"form-actions",children:[(0,t.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>c(!1),children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"btn-primary",children:"Agregar"})]})]})]})]}),(0,t.jsx)("div",{className:"modal-actions",children:(0,t.jsx)("button",{type:"button",className:"btn-secondary",onClick:r,children:"Cerrar"})})]})})},c=()=>{const[e,a]=(0,s.useState)([]),[n,c]=(0,s.useState)(!0),[d,o]=(0,s.useState)(""),[m,h]=(0,s.useState)(!1),[u,x]=(0,s.useState)(null),[p,j]=(0,s.useState)(!1),[v,N]=(0,s.useState)(null),[g,b]=(0,s.useState)(""),[C,f]=(0,s.useState)("all");(0,s.useEffect)(()=>{y()},[]);const y=async()=>{try{c(!0),o("");const e=await i.A.getAllClients();a(e)}catch(d){console.error("Error cargando clientes:",d),o("Error cargando clientes. Verifica tu conexi\xf3n.")}finally{c(!1)}},k=e.filter(e=>{const a=e.name.toLowerCase().includes(g.toLowerCase())||e.email.toLowerCase().includes(g.toLowerCase()),n="all"===C||e.department===C;return a&&n});return n?(0,t.jsx)("div",{className:"client-management-container",children:(0,t.jsxs)("div",{className:"loading-container",children:[(0,t.jsx)("div",{className:"loading-spinner"}),(0,t.jsx)("p",{children:"Cargando clientes..."})]})}):(0,t.jsxs)("div",{className:"client-management-container",children:[(0,t.jsxs)("div",{className:"client-management-header",children:[(0,t.jsx)("h2",{children:"Gesti\xf3n de Clientes"}),(0,t.jsxs)("button",{className:"add-client-btn",onClick:()=>h(!0),children:[(0,t.jsx)("span",{className:"btn-icon",children:"+"}),"Agregar Cliente"]})]}),(0,t.jsxs)("div",{className:"client-management-filters",children:[(0,t.jsx)("div",{className:"search-container",children:(0,t.jsx)("input",{type:"text",placeholder:"Buscar clientes...",value:g,onChange:e=>b(e.target.value),className:"search-input"})}),(0,t.jsx)("div",{className:"filter-container",children:(0,t.jsxs)("select",{value:C,onChange:e=>f(e.target.value),className:"filter-select",children:[(0,t.jsx)("option",{value:"all",children:"Todos los departamentos"}),(()=>{const a=e.map(e=>e.department);return Array.from(new Set(a)).sort()})().map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})})]}),d&&(0,t.jsxs)("div",{className:"error-message",children:[(0,t.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),d]}),(0,t.jsx)("div",{className:"clients-table-container",children:(0,t.jsxs)("table",{className:"clients-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Cliente"}),(0,t.jsx)("th",{children:"Email"}),(0,t.jsx)("th",{children:"Tel\xe9fono"}),(0,t.jsx)("th",{children:"Departamento"}),(0,t.jsx)("th",{children:"Destinatarios"}),(0,t.jsx)("th",{children:"Fecha de Registro"}),(0,t.jsx)("th",{children:"Acciones"})]})}),(0,t.jsx)("tbody",{children:k.map(n=>{return(0,t.jsxs)("tr",{children:[(0,t.jsxs)("td",{className:"client-info",children:[(0,t.jsx)("div",{className:"client-avatar",children:n.name.charAt(0)}),(0,t.jsxs)("div",{className:"client-details",children:[(0,t.jsx)("span",{className:"client-name",children:n.name}),(0,t.jsx)("span",{className:"client-email",children:n.email})]})]}),(0,t.jsx)("td",{className:"client-email",children:n.email}),(0,t.jsx)("td",{className:"client-phone",children:n.phone}),(0,t.jsx)("td",{className:"client-department",children:n.department}),(0,t.jsxs)("td",{className:"recipients-count",children:[n.recipients.length," destinatario",1!==n.recipients.length?"s":""]}),(0,t.jsx)("td",{className:"created-date",children:(s=n.createdAt,new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}))}),(0,t.jsxs)("td",{className:"actions",children:[(0,t.jsx)("button",{className:"action-btn recipients",onClick:()=>(async e=>{try{N(e),j(!0)}catch(d){o(d.message||"Error cargando destinatarios")}})(n),title:"Gestionar destinatarios",children:"\ud83d\udc65"}),(0,t.jsx)("button",{className:"action-btn edit",onClick:()=>(e=>{x(e)})(n),title:"Editar cliente",children:"\u270f\ufe0f"}),(0,t.jsx)("button",{className:"action-btn delete",onClick:()=>(async n=>{if(window.confirm("\xbfEst\xe1s seguro de que quieres eliminar este cliente?"))try{o(""),await i.A.deleteClient(n),a(e.filter(e=>e._id!==n))}catch(d){o(d.message||"Error eliminando cliente")}})(n._id),title:"Eliminar cliente",children:"\ud83d\uddd1\ufe0f"})]})]},n._id);var s})})]})}),0===k.length&&(0,t.jsx)("div",{className:"no-clients",children:(0,t.jsx)("p",{children:"No se encontraron clientes que coincidan con los filtros."})}),(m||u)&&(0,t.jsx)(r,{client:u,onSave:u?async n=>{try{o("");const{_id:s,...t}=n;if(!s)return void o("ID de cliente no encontrado");const r=await i.A.updateClient(s,t);a(e.map(e=>e._id===s?r:e)),x(null)}catch(d){o(d.message||"Error actualizando cliente")}}:async n=>{try{o("");const s=await i.A.createClient(n);a([...e,s]),h(!1)}catch(d){o(d.message||"Error creando cliente")}},onCancel:()=>{h(!1),x(null)}}),p&&v&&(0,t.jsx)(l,{client:v,onAdd:async n=>{if(v)try{o("");const s=await i.A.addRecipient(v._id,n);a(e.map(e=>e._id===v._id?s:e)),N(s)}catch(d){o(d.message||"Error agregando destinatario")}},onRemove:async n=>{if(v)try{o("");const s=await i.A.removeRecipient(v._id,n);a(e.map(e=>e._id===v._id?s:e)),N(s)}catch(d){o(d.message||"Error removiendo destinatario")}},onCancel:()=>{j(!1),N(null)}})]})}}}]);
//# sourceMappingURL=270.291fcb1d.chunk.js.map