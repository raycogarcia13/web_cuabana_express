"use strict";(self.webpackChunkcubana_web=self.webpackChunkcubana_web||[]).push([[999],{999:(e,a,n)=>{n.r(a),n.d(a,{default:()=>t});var r=n(43),s=n(7),i=n(579);const t=()=>{var e,a,n,t,l,o,c,d,m,p;const[h,x]=(0,r.useState)(null),[u,j]=(0,r.useState)([]),[v,g]=(0,r.useState)([]),[y,N]=(0,r.useState)([]),[f,b]=(0,r.useState)(!0),[C,I]=(0,r.useState)(!1),[w,S]=(0,r.useState)(!1),[A,B]=(0,r.useState)(null),[D,E]=(0,r.useState)(!1),[P,k]=(0,r.useState)(null),[T,R]=(0,r.useState)("all"),[F,U]=(0,r.useState)("all"),[_,O]=(0,r.useState)({type:"entrada",amount:0,provinceId:""});(0,r.useEffect)(()=>{z()},[]),(0,r.useEffect)(()=>{let e=[...u];"all"!==T&&(e=e.filter(e=>e.type===T)),"all"!==F&&(e=e.filter(e=>{var a;return(null===(a=e.province)||void 0===a?void 0:a._id)===F})),e.sort((e,a)=>new Date(a.date).getTime()-new Date(e.date).getTime()),g(e.slice(0,10))},[u,T,F]);const z=async()=>{try{const[e,a,n]=await Promise.all([s.A.getFinancialStatus(),s.A.getOperations(),s.A.getAllProvinces()]);x(e),j(a),N(n)}catch(e){console.error("Error loading financial data:",e)}finally{b(!1)}},L=()=>{E(!1),k(null)},M=e=>{const a=new Date,n=new Date(e);return a.toDateString()===n.toDateString()};return f?(0,i.jsx)("div",{className:"finance-loading",children:"Cargando datos financieros..."}):(0,i.jsxs)("div",{className:"finance-management",children:[(0,i.jsxs)("div",{className:"finance-header",children:[(0,i.jsx)("h2",{children:"Administraci\xf3n de Finanzas"}),(0,i.jsx)("button",{className:"add-operation-btn",onClick:()=>I(!0),children:"+ Agregar Operaci\xf3n"})]}),(0,i.jsxs)("div",{className:"finance-summary",children:[(0,i.jsxs)("div",{className:"summary-card total",children:[(0,i.jsx)("h3",{children:"Total General"}),(0,i.jsx)("p",{className:"amount",children:new Intl.NumberFormat("es-CU",{style:"currency",currency:"CUP"}).format((null===h||void 0===h?void 0:h.total)||0)})]}),(0,i.jsxs)("div",{className:"summary-card operations",children:[(0,i.jsx)("h3",{children:"Total de Operaciones"}),(0,i.jsx)("p",{className:"count",children:(null===h||void 0===h?void 0:h.byProvince.reduce((e,a)=>{var n;return e+((null===(n=a.movements)||void 0===n?void 0:n.length)||0)},0))||0})]})]}),(0,i.jsxs)("div",{className:"province-summary",children:[(0,i.jsx)("h3",{children:"Resumen por Provincia"}),(0,i.jsx)("div",{className:"province-grid",children:null===h||void 0===h?void 0:h.byProvince.map((e,a)=>{var n,r;return(0,i.jsxs)("div",{className:"province-card",children:[(0,i.jsx)("h4",{children:(null===(n=e.province)||void 0===n?void 0:n.name)||"Sin provincia"}),(0,i.jsx)("p",{className:"amount",children:new Intl.NumberFormat("es-CU",{style:"currency",currency:"CUP"}).format(e.total)}),(0,i.jsxs)("p",{className:"operations",children:[(null===(r=e.movements)||void 0===r?void 0:r.length)||0," operaciones"]})]},a)})})]}),(0,i.jsxs)("div",{className:"recent-operations",children:[(0,i.jsxs)("div",{className:"operations-header",children:[(0,i.jsx)("h3",{children:"\xdaltimas 10 Operaciones"}),(0,i.jsxs)("div",{className:"filter-controls",children:[(0,i.jsxs)("div",{className:"filter-group",children:[(0,i.jsx)("label",{htmlFor:"filter-type",children:"Tipo:"}),(0,i.jsxs)("select",{id:"filter-type",value:T,onChange:e=>R(e.target.value),className:"filter-select",children:[(0,i.jsx)("option",{value:"all",children:"Todas"}),(0,i.jsx)("option",{value:"entrada",children:"\ud83d\udce5 Entradas"}),(0,i.jsx)("option",{value:"remesa",children:"\ud83d\udcb8 Remesas"}),(0,i.jsx)("option",{value:"recarga",children:"\ud83d\udcf1 Recargas"})]})]}),(0,i.jsxs)("div",{className:"filter-group",children:[(0,i.jsx)("label",{htmlFor:"filter-province",children:"Provincia:"}),(0,i.jsxs)("select",{id:"filter-province",value:F,onChange:e=>U(e.target.value),className:"filter-select",children:[(0,i.jsx)("option",{value:"all",children:"Todas"}),y.map(e=>(0,i.jsx)("option",{value:e._id,children:e.name},e._id))]})]})]})]}),(0,i.jsx)("div",{className:"operations-table",children:(0,i.jsxs)("table",{children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Tipo"}),(0,i.jsx)("th",{children:"Monto"}),(0,i.jsx)("th",{children:"Provincia"}),(0,i.jsx)("th",{children:"Fecha"}),(0,i.jsx)("th",{children:"Acciones"})]})}),(0,i.jsx)("tbody",{children:v.map((e,a)=>{var n;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:`type-${e.type}`,children:"entrada"===e.type?"\ud83d\udce5 Entrada":"remesa"===e.type?"\ud83d\udcb8 Remesa":"\ud83d\udcf1 Recarga"}),(0,i.jsx)("td",{className:"amount",children:new Intl.NumberFormat("es-CU",{style:"currency",currency:"CUP"}).format(Math.abs(e.amount))}),(0,i.jsx)("td",{children:(null===(n=e.province)||void 0===n?void 0:n.name)||"N/A"}),(0,i.jsx)("td",{children:new Date(e.date).toLocaleDateString("es-CU")}),(0,i.jsx)("td",{children:(0,i.jsxs)("div",{className:"table-actions",children:[("remesa"===e.type||"recarga"===e.type)&&e.operationId&&(0,i.jsx)("button",{className:"detail-btn",onClick:()=>"remesa"===e.type?(async e=>{try{const a=await fetch(`https://api-cubana-express.vercel.app/api/remesas/${e}`,{headers:{Authorization:`Bearer ${JSON.parse(localStorage.getItem("cubana_auth")||"{}").token}`,"Content-Type":"application/json"}}),n=await a.json();k(n),E(!0)}catch(a){console.error("Error fetching remesa details:",a)}})(e.operationId):(async e=>{try{const a=await fetch(`https://api-cubana-express.vercel.app/api/recargas/${e}`,{headers:{Authorization:`Bearer ${JSON.parse(localStorage.getItem("cubana_auth")||"{}").token}`,"Content-Type":"application/json"}}),n=await a.json(),r={...n,beneficiary:{phone:n.phone},cost:n.oferta.costo,description:n.oferta.descripcion};k(r),E(!0)}catch(a){console.error("Error fetching recarga details:",a)}})(e.operationId),title:"Ver detalles de "+("remesa"===e.type?"remesa":"recarga"),children:"\ud83d\udccb Detalles"}),M(e.date)&&!e.operationId&&(0,i.jsx)("button",{className:"delete-btn",onClick:()=>{return a=e,console.log("Operation data:",a),console.log("Operation _id:",a._id),console.log("Operation operationId:",a.operationId),B({provinceId:a.province._id,operationId:a._id,type:a.type,amount:Math.abs(a.amount)}),void S(!0);var a},title:"Eliminar operaci\xf3n",children:"\ud83d\uddd1\ufe0f Eliminar"})]})})]},a)})})]})})]}),C&&(0,i.jsx)("div",{className:"modal-overlay",style:{zIndex:9999},children:(0,i.jsxs)("div",{className:"modal",children:[(0,i.jsx)("h3",{children:"Agregar Nueva Operaci\xf3n"}),(0,i.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{await s.A.addOperation(_),await z(),I(!1),O({type:"entrada",amount:0,provinceId:""})}catch(a){console.error("Error adding operation:",a)}},children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Tipo de Operaci\xf3n:"}),(0,i.jsxs)("select",{value:_.type,onChange:e=>O({..._,type:e.target.value}),children:[(0,i.jsx)("option",{value:"entrada",children:"Entrada"}),(0,i.jsx)("option",{value:"remesa",children:"Remesa"}),(0,i.jsx)("option",{value:"recarga",children:"Recarga"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Monto:"}),(0,i.jsx)("input",{type:"number",step:"0.01",min:"0",value:_.amount,onChange:e=>O({..._,amount:parseFloat(e.target.value)}),required:!0})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Provincia:"}),(0,i.jsxs)("select",{value:_.provinceId,onChange:e=>O({..._,provinceId:e.target.value}),required:!0,children:[(0,i.jsx)("option",{value:"",children:"Seleccione una provincia"}),y.map(e=>(0,i.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,i.jsxs)("div",{className:"modal-actions",children:[(0,i.jsx)("button",{type:"button",onClick:()=>I(!1),children:"Cancelar"}),(0,i.jsx)("button",{type:"submit",children:"Agregar"})]})]})]})}),w&&A&&(0,i.jsx)("div",{className:"modal-overlay",style:{zIndex:9999},children:(0,i.jsxs)("div",{className:"modal confirmation-modal",children:[(0,i.jsx)("h3",{children:"Confirmar Eliminaci\xf3n"}),(0,i.jsxs)("p",{children:["\xbfEst\xe1 seguro que desea eliminar esta operaci\xf3n?",(0,i.jsx)("br",{}),(0,i.jsxs)("strong",{children:["entrada"===A.type?"\ud83d\udce5 Entrada":"remesa"===A.type?"\ud83d\udcb8 Remesa":"\ud83d\udcf1 Recarga"," -",new Intl.NumberFormat("es-CU",{style:"currency",currency:"CUP"}).format(A.amount)]})]}),(0,i.jsxs)("div",{className:"confirmation-actions",children:[(0,i.jsx)("button",{className:"cancel-delete",onClick:()=>{S(!1),B(null)},children:"Cancelar"}),(0,i.jsx)("button",{className:"confirm-delete",onClick:async()=>{if(A)try{await s.A.deleteOperation(A.provinceId,A.operationId),await z(),S(!1),B(null)}catch(e){console.error("Error deleting operation:",e)}},children:"Eliminar"})]})]})}),D&&P&&(0,i.jsx)("div",{className:"modal-overlay",style:{zIndex:9999},children:(0,i.jsxs)("div",{className:"modal remesa-detail-modal",style:{maxWidth:"800px",width:"90%"},children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsxs)("h3",{children:["Detalles de ","remesa"===P.type?"Remesa":"Recarga"]}),(0,i.jsx)("button",{className:"modal-close",onClick:L,children:"\xd7"})]}),(0,i.jsxs)("div",{className:"remesa-detail-content",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",padding:"20px"},children:[(0,i.jsxs)("div",{className:"detail-section",children:[(0,i.jsx)("h4",{style:{marginBottom:"12px",color:"#333",borderBottom:"2px solid #007bff",paddingBottom:"5px"},children:"Informaci\xf3n General"}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"ID:"})," ",P._id]}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Estado:"}),(0,i.jsx)("span",{className:"status-badge "+("Realizado"===P.status?"completed":"pending"),style:{marginLeft:"8px"},children:P.status})]}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Fecha:"})," ",new Date(P.date).toLocaleDateString("es-CU")]}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Descripci\xf3n:"})," ",P.description||"N/A"]})]}),(0,i.jsxs)("div",{className:"detail-section",children:[(0,i.jsx)("h4",{style:{marginBottom:"12px",color:"#333",borderBottom:"2px solid #28a745",paddingBottom:"5px"},children:"Informaci\xf3n Financiera"}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Monto:"}),(0,i.jsx)("span",{className:"amount",style:{fontWeight:"bold",color:"#28a745",marginLeft:"8px"},children:new Intl.NumberFormat("es-CU",{style:"currency",currency:"CUP"}).format(P.amount)})]}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Costo:"}),(0,i.jsx)("span",{className:"cost",style:{fontWeight:"bold",color:"#dc3545",marginLeft:"8px"},children:new Intl.NumberFormat("es-CU",{style:"currency",currency:"CUP"}).format(P.cost)})]})]}),(0,i.jsxs)("div",{className:"detail-section",children:[(0,i.jsx)("h4",{style:{marginBottom:"12px",color:"#333",borderBottom:"2px solid #6f42c1",paddingBottom:"5px"},children:"Cliente (Remitente)"}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Nombre:"})," ",(null===(e=P.client)||void 0===e?void 0:e.name)||"N/A"]}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Email:"})," ",(null===(a=P.client)||void 0===a?void 0:a.email)||"N/A"]}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Tel\xe9fono:"})," ",(null===(n=P.client)||void 0===n?void 0:n.phone)||"N/A"]}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Direcci\xf3n:"})," ",(null===(t=P.client)||void 0===t?void 0:t.address)||"N/A"]})]}),(0,i.jsxs)("div",{className:"detail-section",children:[(0,i.jsx)("h4",{style:{marginBottom:"12px",color:"#333",borderBottom:"2px solid #fd7e14",paddingBottom:"5px"},children:"Beneficiario"}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Nombre:"})," ",(null===(l=P.beneficiary)||void 0===l?void 0:l.name)||"N/A"]}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Tel\xe9fono:"})," ",(null===(o=P.beneficiary)||void 0===o?void 0:o.phone)||"N/A"]}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Direcci\xf3n:"})," ",(null===(c=P.beneficiary)||void 0===c?void 0:c.address)||"N/A"]}),(null===(d=P.beneficiary)||void 0===d?void 0:d.cardNumber)&&(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"N\xfamero de Tarjeta:"})," ",P.beneficiary.cardNumber]})]}),(0,i.jsxs)("div",{className:"detail-section",style:{gridColumn:"1 / -1"},children:[(0,i.jsx)("h4",{style:{marginBottom:"12px",color:"#333",borderBottom:"2px solid #20c997",paddingBottom:"5px"},children:"Provincia Destino"}),(0,i.jsxs)("div",{style:{display:"flex",gap:"30px"},children:[(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"Provincia:"})," ",(null===(m=P.destinationProvince)||void 0===m?void 0:m.name)||"N/A"]}),(0,i.jsxs)("p",{style:{margin:"8px 0"},children:[(0,i.jsx)("strong",{children:"C\xf3digo:"})," ",(null===(p=P.destinationProvince)||void 0===p?void 0:p.code)||"N/A"]})]})]}),P.confirmation&&(0,i.jsxs)("div",{className:"detail-section",style:{gridColumn:"1 / -1"},children:[(0,i.jsx)("h4",{style:{marginBottom:"12px",color:"#333",borderBottom:"2px solid #17a2b8",paddingBottom:"5px"},children:"Confirmaci\xf3n"}),(0,i.jsx)("div",{style:{backgroundColor:"#f8f9fa",padding:"12px",borderRadius:"6px",border:"1px solid #dee2e6"},children:(0,i.jsx)("p",{style:{margin:0,fontStyle:"italic"},children:P.confirmation})})]})]}),(0,i.jsx)("div",{className:"modal-actions",style:{padding:"20px",borderTop:"1px solid #dee2e6"},children:(0,i.jsx)("button",{className:"btn-secondary",onClick:L,style:{padding:"10px 20px",borderRadius:"6px",border:"1px solid #6c757d",backgroundColor:"#6c757d",color:"white",cursor:"pointer"},children:"Cerrar"})})]})})]})}}}]);
//# sourceMappingURL=999.cc482a4a.chunk.js.map